# AI CSV Analysis Agent

AI-агент для анализа CSV файлов с использованием Claude Sonnet 4.5 через OpenRouter API.

Аналог [Julius.ai](https://julius.ai/) с открытым исходным кодом.

## Возможности

- Автоматический анализ структуры CSV файлов
- Интеллектуальная генерация Python кода для анализа данных
- Автоматическое исправление ошибок (до 3 попыток)
- Создание визуализаций (графики, диаграммы)
- Интерактивный чат-интерфейс
- Поддержка работы в Google Colab

## Как это работает

1. Пользователь загружает CSV файл в папку с программой
2. Пользователь задает вопрос о данных
3. AI агент анализирует схему CSV (колонки, типы данных, примеры)
4. AI генерирует Python код для анализа
5. Код выполняется автоматически
6. Если возникают ошибки, агент исправляет код и пробует снова
7. Результаты (текст, таблицы, графики) выводятся пользователю

## Установка

### Локальная установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd Claude_code
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` и добавьте ваш API ключ:
```bash
cp .env.example .env
# Отредактируйте .env и добавьте ваш ключ OpenRouter
```

5. Получите API ключ на [OpenRouter](https://openrouter.ai/keys)

## Использование

### Локальный запуск

1. Поместите ваш CSV файл в папку с программой

2. Запустите агента:
```bash
python csv_agent.py
```

3. Агент автоматически найдет CSV файл и загрузит его

4. Начните задавать вопросы о данных:
```
Ваш вопрос: Какая средняя цена в датасете?
Ваш вопрос: Построй гистограмму распределения возраста
Ваш вопрос: Покажи топ-10 записей по продажам
```

### Использование в коде

```python
from csv_agent import CSVAnalysisAgent
from pathlib import Path

# Создайте агента
agent = CSVAnalysisAgent(api_key="ваш_ключ_openrouter")

# Загрузите CSV
df = agent.load_csv(Path("data.csv"))

# Задавайте вопросы
result = agent.analyze_and_execute("Покажи статистику по всем колонкам")

# Или используйте простой интерфейс чата
response = agent.chat("Построй график корреляции между колонками")
print(response)
```

## Google Colab

### Быстрый старт

1. Загрузите файл `colab_csv_agent.py` в ваш Google Drive

2. Откройте новый Colab notebook

3. Установите зависимости:
```python
!pip install openai pandas numpy matplotlib seaborn python-dotenv
```

4. Импортируйте и используйте агента:
```python
# Загрузите код агента
!wget https://raw.githubusercontent.com/your-repo/colab_csv_agent.py

from colab_csv_agent import upload_and_analyze

# Загрузите CSV и создайте агента
agent = upload_and_analyze(api_key='ваш_ключ_openrouter')

# Задавайте вопросы
agent.analyze("Какая средняя цена?")
agent.analyze("Построй гистограмму распределения возраста")
agent.analyze("Покажи топ-10 записей")
```

### Альтернативный способ

```python
from google.colab import files
from colab_csv_agent import ColabCSVAgent

# Создайте агента
agent = ColabCSVAgent(api_key='ваш_ключ')

# Загрузите CSV
uploaded = files.upload()
agent.load_csv_from_upload(uploaded)

# Посмотрите структуру данных
agent.show_schema()

# Анализируйте
agent.analyze("Найди корреляции между числовыми колонками")
agent.analyze("Построй scatter plot для первых двух числовых колонок")
```

## Примеры вопросов

### Статистический анализ
- "Покажи описательную статистику по всем колонкам"
- "Какие колонки имеют пропущенные значения?"
- "Найди выбросы в колонке 'price'"
- "Посчитай корреляцию между всеми числовыми колонками"

### Визуализация
- "Построй гистограмму распределения возраста"
- "Создай box plot для колонки 'salary'"
- "Покажи scatter plot зависимости цены от площади"
- "Построй тепловую карту корреляций"
- "Создай bar chart топ-10 категорий по количеству"

### Фильтрация и группировка
- "Покажи записи где цена больше 1000"
- "Группируй по категории и посчитай среднее"
- "Найди топ-5 городов по населению"
- "Отсортируй по дате и покажи последние 20 записей"

### Агрегация
- "Какая общая сумма продаж?"
- "Посчитай среднюю, медиану и стандартное отклонение для цены"
- "Какой процент пропущенных значений в каждой колонке?"
- "Сколько уникальных значений в каждой категориальной колонке?"

## Архитектура

```
Claude_code/
├── csv_agent.py          # Основной агент для локального использования
├── colab_csv_agent.py    # Версия для Google Colab
├── requirements.txt      # Зависимости Python
├── .env.example          # Пример конфигурации
├── .gitignore           # Git ignore
└── README.md            # Документация
```

### Основные компоненты

1. **CSVAnalysisAgent** - Основной класс агента
   - `find_csv_files()` - Поиск CSV файлов
   - `load_csv()` - Загрузка CSV в DataFrame
   - `analyze_csv_schema()` - Анализ структуры данных
   - `generate_code_with_retry()` - Генерация Python кода через Claude
   - `execute_python_code()` - Безопасное выполнение кода
   - `analyze_and_execute()` - Основной метод анализа

2. **ColabCSVAgent** - Версия для Google Colab
   - Дополнительные методы для работы в Colab
   - Поддержка загрузки файлов через Colab UI
   - Красивый вывод с использованием Markdown и IPython

## Безопасность

- Код выполняется в изолированном окружении
- Доступны только безопасные библиотеки: pandas, numpy, matplotlib, seaborn
- Нет доступа к файловой системе вне рабочей директории
- Нет доступа к сети
- Автоматический timeout для долгих вычислений

## Требования

- Python 3.8+
- OpenRouter API ключ
- Интернет-соединение для API запросов

## Зависимости

```
openai>=1.0.0          # Для OpenRouter API
pandas>=2.0.0          # Работа с данными
numpy>=1.24.0          # Численные вычисления
matplotlib>=3.7.0      # Визуализация
seaborn>=0.12.0        # Продвинутая визуализация
python-dotenv>=1.0.0   # Переменные окружения
tabulate>=0.9.0        # Форматирование таблиц
requests>=2.31.0       # HTTP запросы
pillow>=10.0.0         # Работа с изображениями
```

## Лимиты и ограничения

- Максимум 3 попытки исправления ошибок
- Модель: Claude Sonnet 4.5 (через OpenRouter)
- Размер CSV: ограничен памятью системы
- Timeout выполнения кода: нет (можно добавить при необходимости)

## Стоимость использования

Агент использует Claude Sonnet 4.5 через OpenRouter. Текущие цены:
- Input: ~$3 за 1M токенов
- Output: ~$15 за 1M токенов

Типичный анализ использует 500-2000 токенов на запрос.

Проверьте актуальные цены на [OpenRouter Pricing](https://openrouter.ai/docs#models)

## FAQ

**Q: Какие форматы файлов поддерживаются?**
A: На данный момент только CSV. Планируется добавить Excel, JSON, Parquet.

**Q: Можно ли использовать другие модели?**
A: Да, измените переменную `self.model` в классе агента на любую модель из OpenRouter.

**Q: Безопасно ли выполнять сгенерированный код?**
A: Код выполняется в изолированном окружении с ограниченным доступом. Однако всегда проверяйте сгенерированный код перед выполнением важных операций.

**Q: Что если агент не может выполнить мой запрос?**
A: Попробуйте переформулировать вопрос более конкретно или разбить его на несколько простых вопросов.

**Q: Сохраняется ли история диалога?**
A: Да, история сохраняется в `agent.conversation_history` на время сессии.

## Roadmap

- [ ] Поддержка Excel файлов
- [ ] Поддержка баз данных (SQLite, PostgreSQL)
- [ ] Web интерфейс
- [ ] Поддержка нескольких CSV файлов одновременно
- [ ] Экспорт результатов в PDF/HTML
- [ ] Кеширование результатов
- [ ] Streaming ответов для больших датасетов

## Contribution

Приветствуются Pull Requests! Пожалуйста:

1. Fork репозитория
2. Создайте feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit изменения (`git commit -m 'Add some AmazingFeature'`)
4. Push в branch (`git push origin feature/AmazingFeature`)
5. Откройте Pull Request

## License

MIT License

## Автор

Создано с использованием Claude Code

## Благодарности

- [Julius.ai](https://julius.ai/) - за вдохновение
- [OpenRouter](https://openrouter.ai/) - за доступ к Claude API
- [Anthropic](https://www.anthropic.com/) - за Claude Sonnet 4.5
